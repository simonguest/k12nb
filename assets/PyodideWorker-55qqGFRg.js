async function f(){return await import("./pyodide-Bp229sIy.js")}const p={chess:["/pyodide/chess-1.10.0-py3-none-any.whl"]},m=n=>{const a=[];let o;const e=/^\s*import\s+(\w+)(?:\s+as\s+\w+)?(?:\s*,\s*(\w+)(?:\s+as\s+\w+)?)*|^\s*from\s+(\w+)(?:\.\w+)*\s+import/gm,l=new Set;for(;(o=e.exec(n))!==null;){if(o[1]&&(l.add(o[1]),o[2])){const s=o[2].split(",").map(i=>i.trim());for(const i of s)i&&l.add(i)}o[3]&&l.add(o[3])}for(const s of l)if(p[s]){const i=p[s];for(const t of i)a.includes(t)||a.push(t)}return a};var y="data:application/octet-stream;base64,aW1wb3J0IG1hdHBsb3RsaWIKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgaW8KaW1wb3J0IGJhc2U2NAoKbWF0cGxvdGxpYi51c2UoJ0FHRycpCgojIEFkZCBhIHBsdCBfcmVwcl9wbmdfIGZ1bmN0aW9uIC0gdGhpcyB3aWxsIGVtaXQgYSBwbmcgaWYgcGx0IGlzIHJldHVybmVkIGZyb20gYSBjZWxsCmRlZiBfcmVwcl9wbmdfKCk6CiAgICBidWYgPSBpby5CeXRlc0lPKCkKICAgIHBsdC5zYXZlZmlnKGJ1ZiwgZm9ybWF0PSdwbmcnLCBiYm94X2luY2hlcz0ndGlnaHQnKQogICAgYnVmLnNlZWsoMCkKICAgIGltYWdlX2Jhc2U2NCA9IGJhc2U2NC5iNjRlbmNvZGUoYnVmLmdldHZhbHVlKCkpLmRlY29kZSgndXRmLTgnKSAKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKICAgIGJ1Zi5jbG9zZSgpCiAgICByZXR1cm4gaW1hZ2VfYmFzZTY0CgpwbHQuX3JlcHJfcG5nXyA9IF9yZXByX3BuZ18KCiMgT3ZlcnJpZGUgdGhlIG9yaWdpbmFsIHNob3cgZnVuY3Rpb24KZGVmIG1hdHBsb3RsaWJfY3VzdG9tX3Nob3coKToKICAgIGltYWdlX2Jhc2U2NCA9IHBsdC5fcmVwcl9wbmdfKCkKICAgIGpzLmltYWdlQmFzZTY0KGltYWdlX2Jhc2U2NCkgIyB0eXBlOmlnbm9yZSAgICAKCnBsdC5zaG93ID0gbWF0cGxvdGxpYl9jdXN0b21fc2hvdwo=";const u=["matplotlib"],b=async(n,a)=>{const e=await(await fetch(new URL(Object.assign({"./matplotlib.py":y})[`./${a}.py`],import.meta.url))).text();await n.runPythonAsync(e)};let r,d=null;const g=typeof SharedArrayBuffer<"u";async function I(){console.log("PyodideWorker: Starting Pyodide initialization...");const{loadPyodide:n}=await f();if(r=await n(),g){const e=new SharedArrayBuffer(4);d=new Int32Array(e),r.setInterruptBuffer(d),console.log("PyodideWorker: Interrupt buffer created")}else console.warn("PyodideWorker: SharedArrayBuffer is not available, interrupt functionality will be disabled");console.log("PyodideWorker: Creating override for stdout"),r.globals.set("_override_stdout",{write:e=>(self.postMessage({type:"stdout",text:e}),e.length),flush:()=>{}}),console.log("PyodideWorker: Creating override for js functions"),r.globals.set("js",{imageBase64:e=>{self.postMessage({type:"execute_result",result:{"image/png":[e]}})}}),console.log("PyodideWorker: Initializing Python environment");const o=await(await fetch(new URL("data:application/octet-stream;base64,IyB0eXBlOmlnbm9yZQppbXBvcnQgc3lzCnN5cy5zdGRvdXQgPSBfb3ZlcnJpZGVfc3Rkb3V0IAo=",import.meta.url))).text();await r.runPythonAsync(o)}self.onmessage=async n=>{const{type:a,...o}=n.data;switch(a){case"initialize":try{await I(),self.postMessage({type:"initialized",interruptBuffer:d?d.buffer:null,hasInterrupt:g})}catch(s){console.error("PyodideWorker: Failed to initialize Pyodide:",s),self.postMessage({type:"fatal",error:String(s)})}break;case"run":const e=o.code,l=o.cellId;try{if(r){console.log("PyodideProvider: Loading packages from imports");const s=await r.loadPackagesFromImports(e);console.log("PyodideProvider: Loading additional packages from code");const i=await r.loadPackage(m(e));console.log("PyodideProvider: Searching for overrides");for(const c of[...s,...i])u.indexOf(c.name)!==-1&&(console.log(`PyodideProvider: Implementing override for ${c.name}`),await b(r,c.name));console.log(`PyodideProvider: Running cell ${l}`);const t=await r.runPythonAsync(`${e}`);console.log("PyodideProvider: Returning result"),t&&(typeof t=="object"?("_repr_svg_"in t&&self.postMessage({type:"execute_result",result:{"image/svg+xml":t._repr_svg_()}}),"_repr_html_"in t&&self.postMessage({type:"execute_result",result:{"text/html":t._repr_html_()}}),"_repr_png_"in t&&self.postMessage({type:"execute_result",result:{"image/png":t._repr_png_()}}),self.postMessage({type:"execute_result",result:{"text/plain":t.__repr__()}})):self.postMessage({type:"execute_result",result:{"text/plain":t.toString()}})),self.postMessage({type:"execute_completed"})}}catch(s){console.error(s),self.postMessage({type:"error",error:String(s)})}break}};
